{
  "provisioners": [
    {
      "type": "shell",
      "scripts": [
        "{{template_dir}}/scripts/installers/awspowershell.sh",
        "{{template_dir}}/scripts/installers/auto.sh",
        "{{template_dir}}/scripts/installers/actions-runner.sh"
      ],
      "environment_vars": [
        "METADATA_FILE={{user `metadata_file`}}",
        "HELPER_SCRIPTS={{user `helper_script_folder`}}",
        "DEBIAN_FRONTEND=noninteractive",
        "RUNNER_HOME=/home/runner"
      ],
      "execute_command": "sudo sh -c '{{ .Vars }} {{ .Path }}'"
    },
    {
      "type": "file",
      "source": "{{template_dir}}/etc/github-runner-env",
      "destination": "/tmp/github-runner-env"
    },
    {
      "type": "file",
      "source": "{{template_dir}}/etc/systemd/system/github-runner.service",
      "destination": "/tmp/github-runner.service"
    },
    {
      "type": "file",
      "source": "{{template_dir}}/etc/systemd/system/github-runner-config.service",
      "destination": "/tmp/github-runner-config.service"
    },
    {
      "type": "shell",
      "inline": [
        "mv /tmp/github-runner-env /etc/",
        "mv /tmp/github-runner-config.service /etc/systemd/system/",
        "mv /tmp/github-runner.service /etc/systemd/system/",
        "systemctl enable github-runner-config.service",
        "systemctl enable github-runner.service"
      ],
      "execute_command": "sudo sh -c '{{ .Vars }} {{ .Path }}'"
    }

  ]
}
